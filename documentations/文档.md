# karlooper.web
_**karlooper.web**_ 提供了一个Http Server的相关基本功能。
## karlooper.web.request
这个模块提供了Request类.  
```python
class Request(http_data_dict, http_message, settings)
```
HTTP处理器的基类。  
子类中必须包含至少以下一种HTTP请求方法。  
### Entry points
```python
def get()
```
HTTP请求get方法
```python
def post()
```
HTTP请求post方法
```python
def put()
```
HTTP请求put方法
```python
def head()
```
HTTP请求head方法
```python
def options()
```
HTTP请求options方法
```python
def delete()
```
HTTP请求delete方法
```python
def trace()
```
HTTP请求trace方法
```python
def connect()
```
HTTP请求connect方法
### Cookies
```python
def get_cookie(key, default=None)
```
根据key获取对应的cookie,如果key不存在,则返回默认值。  
```python
def set_cookie(key, value, expires_days=1, path="/", domain=None)
```
设置cookie的值, 其中:  
- key为cookie的键, 
- value为cookie的值,
- expires_days为cookie过期时间,
- path为cookie有效路径,
- domain为cookie有效作用域。
```python
def get_security_cookie(key, default=None)
```
根据key获取已解密的cookie值, 该cookie值在浏览器端进行了加密。  
```python
def set_security_cookie(key, value, expires_days=1, path="/", domain=None)
```
设置cookie的值。  
该cookie的值在浏览器端保存的是经过加密之后的。  
```python
def clear_cookie(key, path="/", domain=None)
```
按照cookie的相关规范, 清除在作用域domain, 路径path下的对应的cookie。
```python
def clear_all_cookie(path="/", domain=None)
```
清除所有的cookie。
### 输入
```python
def get_parameter(key, default=None)
```
获取HTTP请求的参数值。  
如果key不存在,则返回默认值。  
无论是通过HTTP报文体还是url传递的参数,都可以通过这个函数获取到。  
```python
def decode_parameter(key, default=None)
```
根据key值获取参数值。  
若key值不存在则返回默认值。  
无论是通过HTTP报文体还是url传递的参数,都可以通过这个函数获取到。  
注意: 这个方法获取的值必须是经过urlencode之后的值。  
```python
def get_http_request_message()
```
获取HTTP请求报文。  
### 输出
```python
def set_header(self, header_dict)
```
设置HTTP报文头。  
代码示例:
```python
self.set_header({
    "Content-Type": "application/json",
    "Content-Length": "65"
})
```
_**header_dict**_中的key就是HTTP报文头的名称。  
_**header_dict**_中的value就是HTTP报文头的值。  
```python
def clear_header(self, header_dict)
```
清除HTTP报文头, 相当于回撤`set_header`函数的操作。
```python
def response_as_json(data)
```
将python的list或是dict转换成json数据。
```python
def render(template_path, **kwargs)
```
返回模板引擎渲染后的数据, 详细用法请参照jinja2文档。
## karlooper.web.application
此模块提供了Application类。  
```python
class Application(handlers, settings=None, **kwargs)
```
A collection of request handlers that make up a web application.  
Instances of this class are callable and can be passed directly to HTTPServer to serve the application.  
For example:
```python
handlers = {
    "/hello": HelloHandler
}
application = Application(handlers, port=8080)
application.run()
```
If not define the port in anywhere, the server will run on the port 80.
**arguments in init method**  
  `handlers`: A dict contains urls and handlers mapping.  
  `kwargs`: Other arguments, for example: _port_.  
  `settings`: A dict contains some settings.  
  - `template`: config the template files directory.  
  - `cookie`:  config the security cookie's security key.  

**methods**
```python
def listen(port)
```
Starts an HTTP server for this application on the given port.  
```python
def run()
```
Run the web server.  
# karlooper.template
_**karlooper.template**_ provides a simple template system that compiles templates to Python code.  
This template system based on jinja2.  
_**Methods**_:
```python
def render(template_path, **kwargs)
```
Renders the template with the given arguments as the response.  
```python
def render_string(template_string, **kwargs)
```
Renders the template string data with the given arguments as the response.  
# karlooper.escape
_**karlooper.escape**_ provides some escaping/unescaping methods for HTML, URLs, and others.
## Escaping functions
```python
def xhtml_escape(value)
```
Escapes a string so it is valid within HTML or XML.  
Escapes the characters <, >, ", ', and &. When used in attribute values the escaped strings must be enclosed in quotes.
```python
def xhtml_unescape(value)
```
Un-escapes an XML-escaped string.
```python
def url_escape(value, plus=True)
```
Returns a URL-encoded version of the given value.  
If plus is true (the default), spaces will be represented as “+” instead of “%20”.   
This is appropriate for query strings but not for the path component of a URL.  
Note that this default is the reverse of Python’s urllib module.
```python
def url_unescape(value, plus=True)
```
Decodes the given value from a URL.  
The argument may be either a byte or unicode string.  
If encoding is None, the result will be a byte string.  
Otherwise, the result is a unicode string in the specified encoding.  
If plus is true (the default), plus signs will be interpreted as spaces (literal plus signs must be represented as “%2B”).  
This is appropriate for query strings and form-encoded values but not for the path component of a URL.  
Note that this default is the reverse of Python’s urllib module.
## Byte/unicode conversions
```python
def to_unicode(value)
```
Converts a string argument to a unicode string.  
If the argument is already a unicode string or None, it is returned unchanged.  
Otherwise it must be a byte string and is decoded as utf8.
```python
def to_basestring(value)
```
Converts a byte or unicode string into type str.
```python
def utf8(value)
```
Converts a string argument to a byte string.  
If the argument is already a byte string or None, it is returned unchanged.  
Otherwise it must be a unicode string and is encoded as utf8.
# karlooper.utils
_**karlooper.utils**_ provides `security` and `parse_command_line` models.
## security
```python
class DES()
```
DES security class.  
**Methods**:
```python
def input(key, base=10)
```
Set security key.
```python
def encode(s)
```
Encode a string.
```python
def decode(s)
```
Decode a string.
## parse_command_line
```python
class CommandLineParser()
```
This class contains some methods to parse the command line.  
**Method**:
```python
def default(**kwargs)
```
Set default arguments and values, if not type arguments and values in command line.
```python
def parse_command_line()
```
Parsing command line.
# karlooper.logger
_**karlooper.logger**_ provides a model to write the log to file.  
**Methods**:
```python
def init_logger(config_path=None)
```
Init the logger, if config_path is None, the method will use default log configurations.  
After init logger, we can use 
```python
logger = logging.getLogger()
logger.info("it is test")
```
to write log to file.